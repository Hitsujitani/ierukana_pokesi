<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ポケスリ全部いえるかな？</title>
  <style>
    :root {
      --blue-light: #5aa9ff;
      --red-light: #ff7f7f;
      --text-white: #ffffff;
      --disabled-bg: #e0e0e0;
      --disabled-text: #9e9e9e;
    }
    body { font-family: Arial, sans-serif; padding: 20px; text-align: left; }
    h1 { text-align: center; }
    .input-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .hint { font-size: 0.9em; color: #444; }
    input { font-size: 16px; padding: 6px 8px; }
    button { font-size: 16px; padding: 8px 14px; cursor: pointer; border: none; border-radius: 6px; }
    .btn-answer { background: var(--blue-light); color: var(--text-white); }
    .btn-start { background: var(--red-light); color: var(--text-white); }
    .btn-share { background: var(--blue-light); color: var(--text-white); }
    button:disabled, input:disabled { background: var(--disabled-bg) !important; color: var(--disabled-text) !important; cursor: not-allowed; }
    #scrollContainer { max-height: 500px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin: 20px auto; width: 90%; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; justify-content: center; }
    .grid div { font-weight: bold; }
    .footer { width: 90%; margin: 10px auto 0 auto; font-size: 12px; color: #555; text-align: right; line-height: 1.6; }
    .status-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-top: 8px; }
    .status-left { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .status-right { margin-left: auto; }
    /* モーダル */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 9999; }
    .modal { background: #fff; padding: 20px; border-radius: 8px; width: min(520px, 90vw); box-shadow: 0 6px 24px rgba(0,0,0,0.2); }
    .modal h2 { margin-top: 0; }
    .modal .actions { text-align: right; margin-top: 16px; display: flex; gap: 8px; justify-content: flex-end; }
    .modal button { font-size: 14px; padding: 6px 12px; }
    html, body {
  height: 100%;
}
body {
  margin: 0;
  /* 画像パスは配置場所に合わせて変更 */
  background-image: url("./greenglass.jpg");
  background-size: cover;       /* 画面いっぱいに拡大縮小 */
  background-position: center;  /* 中央寄せ */
  background-repeat: no-repeat; /* 繰り返しなし */
  /* 必要なら固定表示 → モバイルでの描画が重い場合は外してください */
  /* background-attachment: fixed; */
  background-color: #8fdc6b;    /* 読み込み前の下地色（任意） */
}
  </style>
</head>
<body>
  <h1>ポケスリ全部いえるかな？</h1>

  <div class="input-row">
    <p class="hint">ポケモンの名前を入力してください（ひらがなOK）</p>
    <strong id="progressText">0／0</strong>
  </div>

  <div class="status-row">
    <div class="status-left">
      <input type="text" id="pokemonInput" placeholder="ポケモンの名前を入力" disabled />
      <button id="answerBtn" class="btn-answer" disabled>回答</button>
      <button id="startBtn" class="btn-start">開始</button>
      <span id="timer">00:00:00</span>
    </div>
    <div class="status-right">
      <button id="shareBtnMain" class="btn-share">結果をXで共有</button>
    </div>
  </div>

  <div id="scrollContainer">
    <div class="grid" id="pokemonList">
      <div id="poke-0">0001. ???</div><div id="poke-1">0002. ???</div><div id="poke-2">0003. ???</div><div id="poke-3">0004. ???</div><div id="poke-4">0005. ???</div><div id="poke-5">0006. ???</div><div id="poke-6">0007. ???</div><div id="poke-7">0008. ???</div><div id="poke-8">0009. ???</div><div id="poke-9">0010. ???</div><div id="poke-10">0011. ???</div><div id="poke-11">0012. ???</div>
    </div>
  </div>

  <div class="footer">
    <div> Ver. 2.12.2 </div>
    <div> X：羊谷ランプ@fuck_capslock（<a href="https://x.com/fuck_capslock" target="_blank" rel="noopener noreferrer">https://x.com/fuck_capslock</a>）</div>
    <div> Inspired by ポケモン全部言えるかな？ゲーム </div>
  </div>

  <!-- 全問正解ポップアップ（モーダル） -->
  <div id="completeOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="completeTitle">
    <div class="modal">
      <h2 id="completeTitle">全問正解！あなたは立派な廃人プレイヤーです！！</h2>
      <div class="actions">
        <button id="completeShareBtn" class="btn-share">結果をXで共有</button>
        <button id="completeOk" class="btn-start">OK</button>
      </div>
    </div>
  </div>

  <script>
    const pokemonTableRaw = ["フシギダネ", "フシギソウ", "フシギバナ", "ヒトカゲ", "リザード", "リザードン", "ゼニガメ", "カメール", "カメックス", "キャタピー", "トランセル", "バタフリー"];
    const pokemonNumbers = ["0001", "0002", "0003", "0004", "0005", "0006", "0007", "0008", "0009", "0010", "0011", "0012"];
    let correctFlags = Array(pokemonTableRaw.length).fill(false);
    let solvedCount = 0;
    const totalCount = pokemonTableRaw.length;

    const progressText = document.getElementById("progressText");
    const inputElem = document.getElementById("pokemonInput");
    const answerBtn = document.getElementById("answerBtn");
    const startBtn = document.getElementById("startBtn");
    const timerElem = document.getElementById("timer");
    const shareBtnMain = document.getElementById("shareBtnMain");

    // モーダル
    const overlay = document.getElementById("completeOverlay");
    const completeShareBtn = document.getElementById("completeShareBtn");
    const completeOk = document.getElementById("completeOk");

    // タイマー
    let startTime = null;
    let timerId = null;
    let running = false;

    function formatTime(ms) {
      const totalSec = Math.floor(ms / 1000);
      const h = String(Math.floor(totalSec / 3600)).padStart(2, '0');
      const m = String(Math.floor((totalSec % 3600) / 60)).padStart(2, '0');
      const s = String(totalSec % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    function startTimer() {
      if (running) return;
      startTime = Date.now();
      timerId = setInterval(() => {
        const elapsed = Date.now() - startTime;
        timerElem.textContent = formatTime(elapsed);
      }, 200);
      running = true;
      // 入力と回答を有効化
      inputElem.disabled = false;
      answerBtn.disabled = false;
      inputElem.focus();
    }

    function stopTimer() {
      if (!running) return;
      clearInterval(timerId);
      timerId = null;
      running = false;
    }

    // 進捗表示更新
    function updateProgress() {
      progressText.textContent = solvedCount + "／" + totalCount;
    }
    updateProgress();

    // ひらがな→カタカナ
    function toKatakana(str) {
      return str.replace(/[ぁ-ゖ]/g, ch => String.fromCharCode(ch.charCodeAt(0) + 0x60));
    }

    function checkPokemon() {
      if (inputElem.disabled) return; // 念のため
      const input = inputElem.value.trim();
      if (input === "") return;

      const katakanaInput = toKatakana(input);
      const listItems = document.querySelectorAll("#pokemonList div");

      for (let i = 0; i < pokemonTableRaw.length; i++) {
        const katakanaAnswer = toKatakana(pokemonTableRaw[i]);
        if (!correctFlags[i] && katakanaInput === katakanaAnswer) {
          correctFlags[i] = true;
          listItems[i].textContent = pokemonNumbers[i] + ". " + pokemonTableRaw[i];
          listItems[i].scrollIntoView({ behavior: "smooth", block: "center" });
          solvedCount++;
          updateProgress();
          break;
        }
      }

      if (solvedCount === totalCount) {
        stopTimer();
        // 完了ポップアップを表示
        overlay.style.display = "flex";
      }

      inputElem.value = "";
      inputElem.focus();
    }

    // Enter確定時のみ回答（IME中は発火しない）
    inputElem.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.isComposing) {
        checkPokemon();
      }
    });

    // ボタン
    answerBtn.addEventListener("click", checkPokemon);
    startBtn.addEventListener("click", startTimer);

    // 画面の右端の共有ボタン（挑戦状況）
    shareBtnMain.addEventListener("click", () => {
      const text = `「ポケスリ全部いえるかな」ゲームに挑戦しました！${totalCount}匹中${solvedCount}覚えていたよ！経過時間は:${timerElem.textContent}でした。 https://hitsujitani.github.io/ierukana_pokesuri/`;
      const url = "https://x.com/intent/tweet?text=" + encodeURIComponent(text);
      window.open(url, "_blank");
    });

    // 完了ポップアップの共有ボタン
    completeShareBtn.addEventListener("click", () => {
      const text = `「ポケスリ全部いえるかな」ゲームに挑戦しました！お見事！全問正解です！！達成時間は${timerElem.textContent}でした。 https://hitsujitani.github.io/ierukana_pokesuri/`;
      const url = "https://x.com/intent/tweet?text=" + encodeURIComponent(text);
      window.open(url, "_blank");
    });

    // モーダル OK で閉じる
    completeOk.addEventListener("click", () => {
      overlay.style.display = "none";
    });
  </script>
</body>
</html>
